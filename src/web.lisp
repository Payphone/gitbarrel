(in-package #:cl-user)
(defpackage gitbarrel.web
  (:use #:cl
        #:caveman2
        #:gitbarrel.config
        #:gitbarrel.view
        #:peyton-utils
        #:git-info
        #:files-and-folders)
  (:export #:*web*))
(in-package #:gitbarrel.web)

;;
;; Application

(defclass <web> (<app>) ())
(defvar *web* (make-instance '<web>))
(clear-routing-rules *web*)
(defparameter *repositories* (merge-paths *application-root* #P"git/"))

(defun generate-index ()
  (with-open-file (in (merge-paths *repositories* "index")
                      :if-exists :supersede
                      :if-does-not-exist :create
                      :direction :output)
    (format in "誉撖扉篝犰飙骈戾蝈痫箝麸蜷弩┅┅ㄤ彐躅箦狎汨骘颦骈戾箦狎汨翦蝽戾è翦蝽篝蜷铉躔汜箦箦狎汨翦蝽┅鏖翳镳孱骈戾ㄩ礤蜱瀛疳翳蝈痫箝麸蜷弩㈤钿屮┅祜镳骘疳翳蝈徜轭铋号掀躅糸ㄥ疳翳号掀麒孱箦狎汨翦蝽篝蜷铉躔汜箦疳翳钺礤钺礤疳翳┅泔祆邈箬矧翦瞽溟蝈泗矧疳翳㈢轸┅┅换换绎豸轭蝓戾ㄤ彐蝻豸ī蝈钿弪Ｐ㈤钿屮梏盱┅ㄤ彐蝻豸á箦狎汨喉弭栾盒嫌冤é脲翦蝽蝈溟蝈泗ㄣ狒箦狎汨眶弪斫翦蝽┅ㄤ彐蝻豸箦狎汨é脲翦蝽蝈钿弪ＰⅢ遽蜚璁梏盱扉篝烘殪弩箦狎汨骘颦骈戾翦蝽┅┅ㄤ彐蝻豸躞弪螈ī蝈钿弪Ｐ㈧轶舢梏盱扉篝烘殪弩磲疸狎＇灬礅溽ㄤ箬矧翦瞽溟蝈泗矧㈢轸┅蝈盹鲥殒＇骈戾扉篝溟蝈泗矧蝈痫箝麸蜷弩┅┅┅ㄤ彐蝻豸áó┋ó┋ó候彗屮呼é脲汜痿躜弩戾舄è躞弪ㄦ轵篝汜痿躜弩┅ㄤ轵邈麸蝙箦泔钿汜痿躜弩┅蝈痫箝麸蝙礤蜱瀛疳翳蝈痫箝麸蜷弩躞弪溟蝈泗矧┅ㄦ殪翳轵汜痿躜弩┅ㄩ痱镡瀛骈戾礤蜱瀛疳翳蝈痫箝麸蝙骈戾┅蝈钿弪Ｐ㈡殪瀹梏盱扉篝烘殪蝈徜骈戾礤蜱瀛疳翳蝈痫箝麸蝙骈戾┅烘殪弩趄徙脲洵骈戾蝈痫箝麸蝙轰轵邈麸蝙溟蝈泗矧乎箦躞弪┅镱屮沐痿轱麇猹窗穿┅ㄤ彐蝻豸áó┋ó候彗屮呼é脲汜痿躜弩戾舄è躞弪ㄦ轵篝汜痿躜弩┅ㄤ轵邈麸蝙蝈盹鲥＼箦泔钿汜痿躜弩┅蝈痫箝麸蝙礤蜱瀛疳翳蝈痫箝麸蜷弩躞弪溟蝈泗矧┅ㄩ痱镡瀛骈戾蝈痫箝麸蝙蝈钿弪ＰⅡ屦矬轸矧梏盱扉篝轰轵邈麸蝙溟蝈泗矧乎箦躞弪烘殪弩趄徙脲洵骈戾蝈痫箝麸蝙呼徵翎珞蝈痫箝麸蝙恒镯黹趔蝈盹鲥殒铒＇灬礅溽ㄣ篝蜷铉泔眄轸祜绛豉疱悌┅祜珞蝈痫箝麸蝙┅┅镱屮沐痿轱麇猹窗穿┅ㄤ彐蝻豸áó候彗屮呼é脲汜痿躜弩戾舄è躞弪ㄦ轵篝汜痿躜弩┅蝈痫箝麸蜷弩扉篝溟蝈泗矧礤蜱瀛疳翳蝈痫箝麸蜷弩躞弪┅┅ㄩ蝈痫箝麸蜷弩蝈钿弪Ｐ㈧轶舢梏盱扉篝烘殪弩磲疸狎＇灬礅溽ㄤ箬矧翦瞽溟蝈泗矧㈢轸┅蝈痫箝麸蜷弩乎箦躞弪┅镱屮沐痿轱麇猹窗穿┅换换膨蝻疳珏ㄤ彐躅弪蝻颦蝈狍镱ㄥ蝌矧泔溴戾è梏麴弪蝻Жù按⑽雉骑躅洧ù俺⑸铙蹑骈汩孱绣蝽轶箝镱螈┅┅ㄣ潋ㄡ篌镢弪蝻颦泔溴梏麴弪蝻颟┅ㄤ彐礤翳镤镱屮沐痿轱è狃槛邂京弪蝻颦泔溴ㄤ邈灬蝈ㄩ珙矧狃皓蝈钿弪㈠蝌矧梏盱扉篝哄蝌矧泔溴弪蝻颦泔溴哄蝌矧礤篌徵ㄥ蝌矧蝈狍镱弪蝻颦泔溴┅┅